<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-localstorage/iron-localstorage.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-media-query/iron-media-query.html">
<link rel="import" href="../../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="../../bower_components/neon-animation/neon-shared-element-animatable-behavior.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">

<!-- <link rel="import" href="../../bower_components/paper-button/paper-button.html"> -->

<link rel="import" href="../../bower_components/web3-wallet/web3-wallet.html">
<link rel="import" href="../../bower_components/ipfs-upload/ipfs-upload.html">

<link rel="import" href="../../bower_components/locals-avatar/locals-avatar.html">
<link rel="import" href="../../bower_components/locals-residence/locals-residence.html">

<link rel="import" href="../../bower_components/locals-button/locals-button.html">
<link rel="import" href="../../bower_components/locals-lsapi/locals-lsapi.html">
<link rel="import" href="../../bower_components/locals-icon/locals-icon.html">
<link rel="import" href="../../bower_components/locals-scroller/locals-scroller.html">
<link rel="import" href="../../bower_components/locals-store/locals-store.html">
<link rel="import" href="../../bower_components/locals-style/locals-style.html">
<link rel="import" href="../../bower_components/locals-verification/locals-verification-validator.html">
<link rel="import" href="../../bower_components/locals-verification/locals-verification-localstorage.html">

<link rel="import" href="../../bower_components/locals-whisperer/locals-whisperer.html">



<dom-module id="locals-home">
  <template>
    <style>
      :host {
        display: block;
        background-color: white;
        --topbar-height: 100px;
        --scrollarea-height: 800px;
        --bg-size: auto 800px;
        --scrollarea-padding: 200px 0px 0px 0px;
      }


      .topbar {
        width: 100%;
        height: var(--topbar-height);
        background-color: #a8daf0;
        @apply(--layout-horizontal);
        @apply(--layout-center);
        box-sizing: border-box;
        padding: 10px 20px 10px 10px;
        }

      .scrollarea {
        width: 100%;
        min-height: var(--scrollarea-height);
        background: url(../../images/locals-bg.png);
        background-size: var(--bg-size);
        background-repeat: repeat-x;
        @apply(--layout-horizontal);
        @apply(--layout-center-justified);
        box-sizing: border-box;
        padding: var(--scrollarea-padding);
        margin-top: -1px;
      }

      .flex {
        @apply(--layout-horizontal);
        @apply(--layout-flex);
      }

/*      #storebtn {
        z-index: 11;

      }*/

      .balance {
        @apply(--layout-horizontal);
        @apply(--layout-center);
      }


      .menuicon {
        cursor: pointer;
        height: 60px;
        width: 60px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
      }

      #test {
        width: 50px;
        height: 20px;
        background-color: green;
        display: none;
      }


      ::-webkit-scrollbar { 
          display: none; 
      }

      #fooContainer {
        width: 100%;
      }

      .foo {
        transition: all .05s linear;
        transform: scale(0.9,0.9);
        box-sizing: border-box;
        margin:0px -5px 0px -5px;
      }


      iron-selector {
        @apply(--layout-horizontal);
        @apply(--layout-center);
        width: 100%;
        overflow-x: scroll;
        box-sizing: border-box;
        padding-left: 10vw;      
       }

      .iron-selected .foo {
        transform: scale(1,1);
      }


      .listmenu {
        width: 100%;
        min-height: 50vh;
        margin-top: 5vh;
        @apply(--layout-vertical);
        @apply(--layout-center);
      }


      .lijntje {
        height: 3px;
        background-color: var(--locals-blue);
        width: 50px;
        visibility: hidden;
        margin-top: 20px;
      }

      .iron-selected .lijntje {
        visibility: visible;
      }



      #total {
        @apply(--layout-vertical);
        @apply(--layout-center-center);
      }



      #totaldata {
        width: 100%;
        max-width: 1000px;
        margin:0px;
        padding: 0px;
      }






/*      .listmenuxl {
        width: 100%;
        border-top: 1px dashed var(--locals-grey2);
        margin-top: 5vh;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        @apply(--layout-wrap);
      }

      .renderxl {
        width: 300px;
        height: 300px;

        border:1px solid red;

      }
*/


    </style>

  <!--   
    <div class="topbar">
      <div class="menuicon">
        <locals-icon icon="menu" iconcolor="darkgrey" on-tap="firetoggle"></locals-icon>
      </div> -->
<!--     <div class="balance">
      <locals-icon small icon="localcoin" iconcolor="grey5"></locals-icon>
      <p><span>{{locbalans}}</span></p>
    </div> -->
    <!-- <paper-input>WATWAT</paper-input> -->
    <!--   <p class="flex"></p>
      <locals-verification-localstorage data="{{incomingvalidations}}" nrofitems="{{nrofval}}" id="lvls">
      </locals-verification-localstorage>
      <locals-verification-handler topic="{{topic}}" progress="{{progress}}" on-tap="toVerification" vals="{{nrofval}}"></locals-verification-handler>
      <locals-button bg="white" id="storebtn" icon="plus" on-tap="toStore" class$="{{storebtnclass}}"></locals-button>
    </div>

    <div class="scrollarea">
      <div id="fooContainer">
      <iron-selector>
          <template is="dom-repeat" items="{{dataset}}">
            <div id="total">
              <locals-objectrender sizeview="{{sizeview}}" on-detail-tapped="gotodetail" key="{{item.component.name}}" objectdata="{{item}}" renderstate="visual" class="foo">
              </locals-objectrender> 
              <div class="lijntje"></div>
            </div>
          </template>
        </iron-selector>
      </div>
    </div>

    <div class="listmenu">
      <template is="dom-repeat" items="{{dataset}}">
        <div id="totaldata">
          <locals-objectrender sizeview="{{sizeview}}" on-detail-tapped="gotodetail" key="{{item.component.name}}" objectdata="{{item}}" renderstate="closed">
          </locals-objectrender>
        </div>
      </template>
    </div>
 -->
 <neon-animated-pages selected="0" entry-animation="slide-from-right-animation" exit-animation="slide-left-animation">
    <template is="dom-repeat" items="{{accounts}}">
     <neon-animatable>
    
    <div class="topbar">
      <div class="menuicon">
        <locals-icon icon="menu" iconcolor="darkgrey" on-tap="firetoggle"></locals-icon>
      </div>

    <p class="flex"></p>
      <locals-verification-localstorage data="{{incomingvalidations}}" nrofitems="{{nrofval}}" id="lvls">
      </locals-verification-localstorage>
<!--       <locals-verification-handler topic="{{topic}}" progress="{{progress}}" on-tap="toVerification" vals="{{nrofval}}"></locals-verification-handler>
      <locals-button bg="white" id="storebtn" icon="plus" on-tap="toStore" class$="{{storebtnclass}}"></locals-button> -->
    </div>


    <div class="scrollarea">
      <locals-avatar renderstate="visual"></locals-avatar>
    </div>
       
    <h1>{{account}}</h1>
    <p>{{balance}}</p>

       <iron-selector>
          <template is="dom-repeat" items="{{dataset}}">
            <div id="total">
              <locals-objectrender sizeview="{{sizeview}}" on-detail-tapped="gotodetail" key="{{item.component.name}}" objectdata="{{item}}" renderstate="closed" class="foo">
              </locals-objectrender> 
              <div class="lijntje"></div>
            </div>
          </template>
        </iron-selector>

     </neon-animatable>
     </template>

     <neon-animatable>
       add identity
     </neon-animatable>
    
 </neon-animated-pages>

</template>
<script>
  (function() {
    'use strict';

    Polymer({
      is: 'locals-home',
      
      behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior
      ],

      properties: {

        data: {
          observer: '_data'
        },

        sizeview: {
          type: String,
          observer: '_sizeview'
        },

        web3: {
          type: Object,
          observer: '_web3'
        },

        keystore: {
          type: Object,
          observer: '_keystore'
        },

        accounts: {
          type: Array,
          value: [{ account: '0x000', 
                    label: 'Locals User A3FE1',
                    balance: 42,
                    rep: 10
                  }]
        }

      },

      sj: function(a){
        return JSON.stringify(a);
      },

      ready: function(){
      },
      
     attached: function() {
      window.sr = ScrollReveal({distance: 0, origin: 'top', scale: 0.4, reset: true});
      var fooContainer = document.getElementById('fooContainer');
      window.sr.reveal('.foo', { opacity: 1, easing: 'cubic-bezier(0.150, 0.450, 0.150, 0.735)', viewFactor:0.1, duration: 300,
            delay: 0, container: fooContainer, distance: 0, origin: 'top', scale: 0.6, reset: true });
        //this.loadAccounts();
      },

      _keystore: function(){
        //console.log('accoutns:',this.keystore.getAddresses()[0]);
        //this.accounts = this.keystore.getAddresses();
      },

      gotodetail: function(e){
        console.log('Ga naar detail',e.detail);
        this.fire('to-detail', {object: e.detail});
      },

      toStore: function(){
        this.fire('to-store');
      },

      toVerification: function(){
        this.fire('to-verification');
      },

      _data: function(){
        console.log('****** HOME has data: ',this.data.collection);
      this.dataset = this.object2array(this.data.collection);

      },


      _sizeview: function(){
        switch(this.sizeview) {
            case 'phone':
                this.customStyle['--topbar-height'] = '100px';
                this.customStyle['--scrollarea-height'] = '160px';
                this.customStyle['--scrollarea-padding'] = '0px 0px 0px 0px';
                this.customStyle['--bg-size'] = 'auto 160px';
                this.updateStyles();
                break;
            case 'desktop':
                this.customStyle['--topbar-height'] = '100px';
                this.customStyle['--scrollarea-height'] = '260px';
                this.customStyle['--scrollarea-padding'] = '0px 0px 0px 0px';
                this.customStyle['--bg-size'] = 'auto 260px';
                this.updateStyles();
                break;
            case 'xlarge':
                this.customStyle['--topbar-height'] = '100px';
                this.customStyle['--scrollarea-height'] = '270px';
                this.customStyle['--scrollarea-padding'] = '0px 0px 0px 0px';
                this.customStyle['--bg-size'] = 'auto 270px';
                this.updateStyles();
                break;
            default:
            //console.log("!!! ** Niks");
        }
      },


      back: function(){
        Excess.RouteManager.transitionTo('/home');
      },

      firetoggle: function(){
        this.fire('toggle-drawer');
      },


    // selectobject: function(e) {
    //   this.selectedobject = this.dataset[e.target.id];
    //   this.fire('object-selected', {object: this.selectedobject});
    // },

    // back: function(){
    //   this.page = 0;
    // },

    object2array: function(input){
      var newarray = [];
      var p = input;
      //var previewdata = Object.keys(input);
      for (var key in p) {        
        if (p.hasOwnProperty(key)) {
          newarray.key = key;
          newarray.push(p[key]);
        }
      }
      return newarray;
    },



      _is: function(a, b) {
        if (b === undefined){
          b = true;
        }
        //console.log(a ,'(',typeof a,') is',b,'(',typeof b,') they are equal for ==',a == b,', they are equal for ===',a === b);
        return a === b;
      },


    });
  })();
  </script></dom-module>